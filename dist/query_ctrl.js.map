{"version":3,"sources":["../src/query_ctrl.js"],"names":["QueryCtrl","EventStoreQueryCtrl","$scope","$injector","scope","target","selectedTable","selectedColumn","queryString","selectedTimestamp","readOption","tables","columns","type","resultFormats","name","value","readOptions","datasource","metricAPIQuery","displayTables","table","t","push","refresh","displayColumns","column","c","query","metricFindQuery","rawQuery","panelCtrl","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,e,kBAAAA,S;;;;;;;;;;;;;;;;;;;;;qCAGKC,mB;;;AAEX,qCAAYC,MAAZ,EAAoBC,SAApB,EAAgC;AAAA;;AAAA,gJACxBD,MADwB,EAChBC,SADgB;;AAG9B,gBAAKC,KAAL,GAAaF,MAAb;AACA,gBAAKG,MAAL,CAAYC,aAAZ;AACA,gBAAKD,MAAL,CAAYE,cAAZ;AACA,gBAAKF,MAAL,CAAYG,WAAZ;AACA,gBAAKH,MAAL,CAAYI,iBAAZ;AACA,gBAAKJ,MAAL,CAAYK,UAAZ,GAAyB,aAAzB;AACA,gBAAKL,MAAL,CAAYM,MAAZ,GAAqB,EAArB;AACA,gBAAKN,MAAL,CAAYO,OAAZ,GAAsB,EAAtB;AACA,gBAAKP,MAAL,CAAYA,MAAZ,GAAqB,MAAKA,MAAL,CAAYA,MAAZ,IAAsB,eAA3C;AACA,gBAAKA,MAAL,CAAYQ,IAAZ,GAAmB,MAAKR,MAAL,CAAYQ,IAAZ,IAAoB,YAAvC;AACA,gBAAKR,MAAL,CAAYS,aAAZ,GAA4B,CAAC,EAAEC,MAAM,aAAR,EAAuBC,OAAO,aAA9B,EAAD,EAAgD,EAAED,MAAM,OAAR,EAAiBC,OAAO,OAAxB,EAAhD,CAA5B;AACA,gBAAKX,MAAL,CAAYY,WAAZ,GAA0B,CAAC,EAACF,MAAM,aAAP,EAAsBC,OAAO,aAA7B,EAAD,EAA8C,EAACD,MAAM,aAAP,EAAsBC,OAAO,aAA7B,EAA9C,EAA2F,EAACD,MAAM,cAAP,EAAuBC,OAAO,cAA9B,EAA3F,CAA1B;AACA,gBAAKE,UAAL,CAAgBC,cAAhB,CAA+B,cAA/B,EAA+C,MAAKC,aAApD;AAf8B;AAgB/B;;;;wCAEcT,M,EAAQP,K,EAAO;AAC5B,gBAAIiB,KAAJ;AACA,iBAAKA,KAAL,IAAcV,MAAd,EAAsB;AACpB,kBAAIW,IAAIX,OAAOU,KAAP,CAAR;AACAjB,oBAAMC,MAAN,CAAaM,MAAb,CAAoBY,IAApB,CAA0B,EAACR,MAAMO,EAAEP,IAAT,EAAeC,OAAOM,EAAEP,IAAxB,EAA1B;AACD;AACF;;;4CAEkB;AACjB,iBAAKS,OAAL;AACA,iBAAKN,UAAL,CAAgBC,cAAhB,CAA+B,qBAA/B,EAAsD,KAAKM,cAA3D,EAA2E,IAA3E,EAAiF,eAAe,KAAKpB,MAAL,CAAYC,aAA5G;AACD;;;yCAEeM,O,EAASR,K,EAAO;AAC9B,gBAAIsB,MAAJ;AACA,iBAAKA,MAAL,IAAed,OAAf,EAAwB;AACtB,kBAAIe,IAAIf,QAAQc,MAAR,CAAR;AACAtB,oBAAMC,MAAN,CAAaO,OAAb,CAAqBW,IAArB,CAA2B,EAACR,MAAMY,EAAEZ,IAAT,EAAeC,OAAOW,EAAEZ,IAAxB,EAA3B;AACD;AACF;;;6CAEmB,CACnB;;;qCAEUa,K,EAAO;AAChB,mBAAO,KAAKV,UAAL,CAAgBW,eAAhB,CAAgCD,SAAS,EAAzC,CAAP;AACD;;;6CAEkB;AACjB,iBAAKvB,MAAL,CAAYyB,QAAZ,GAAuB,CAAC,KAAKzB,MAAL,CAAYyB,QAApC;AACD;;;6CAEkB;AACjB,iBAAKC,SAAL,CAAeP,OAAf,GADiB,CACS;AAC3B;;;6CAEkB;AACjB,iBAAKnB,MAAL,CAAYG,WAAZ,GAA0B,YAAY,KAAKH,MAAL,CAAYE,cAAxB,GAAyC,QAAzC,GAAoD,KAAKF,MAAL,CAAYC,aAA1F;AACA,mBAAO,KAAKD,MAAL,CAAYG,WAAnB;AACD;;;;QA3DsCR,S;;;;AA8DzCC,0BAAoB+B,WAApB,GAAkC,4BAAlC","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport class EventStoreQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector)  {\n    super($scope, $injector);\n\n    this.scope = $scope;\n    this.target.selectedTable;\n    this.target.selectedColumn;\n    this.target.queryString;\n    this.target.selectedTimestamp;\n    this.target.readOption = 'SnapshotAny';\n    this.target.tables = [];\n    this.target.columns = [];\n    this.target.target = this.target.target || 'select metric';\n    this.target.type = this.target.type || 'timeseries';\n    this.target.resultFormats = [{ name: 'Time series', value: 'time_series' }, { name: 'Table', value: 'table' }];\n    this.target.readOptions = [{name: 'SnapshotAny', value: 'SnapshotAny'}, {name: 'SnapshotNow', value: 'SnapshotNow'}, {name: 'SnapshotNone', value: 'SnapshotNone'}];\n    this.datasource.metricAPIQuery('/oltp/tables', this.displayTables, this);\n  }\n\n  displayTables (tables, scope) {\n    var table;\n    for (table in tables) {\n      var t = tables[table];\n      scope.target.tables.push ({name: t.name, value: t.name});\n    }\n  }\n\n  onTableSelected () {\n    this.refresh();\n    this.datasource.metricAPIQuery('/oltp/table/columns', this.displayColumns, this, 'tableName=' + this.target.selectedTable);\n  }\n\n  displayColumns (columns, scope) {\n    var column;\n    for (column in columns) {\n      var c = columns[column];\n      scope.target.columns.push ({name: c.name, value: c.name});\n    }\n  }\n\n  onColumnSelected () {\n  }\n\n  getOptions(query) {\n    return this.datasource.metricFindQuery(query || '');\n  }\n\n  toggleEditorMode() {\n    this.target.rawQuery = !this.target.rawQuery;\n  }\n\n  onChangeInternal() {\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\n  }\n\n  getCollapsedText() {\n    this.target.queryString = 'SELECT ' + this.target.selectedColumn + ' FROM ' + this.target.selectedTable;\n    return this.target.queryString;\n  }\n}\n\nEventStoreQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}